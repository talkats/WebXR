<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Simple AR Viewer</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #overlay {
            position: fixed;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        #top-bar {
            background: rgba(255,255,255,0.9);
            padding: 1rem;
            pointer-events: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
        }

        #bottom-bar {
            background: rgba(255,255,255,0.9);
            padding: 1rem;
            margin-top: auto;
            pointer-events: auto;
            display: flex;
            justify-content: center;
            gap: 1rem;
            width: 100%;
            box-sizing: border-box;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 1rem;
            font-size: 1.2rem;
            min-width: 3rem;
            min-height: 3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #file-input {
            max-width: 200px;
            font-size: 1rem;
        }

        #status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="overlay">
        <div id="top-bar">
            <input type="file" id="file-input" accept=".glb">
        </div>
        <div id="bottom-bar">
            <button class="btn" id="smaller">-</button>
            <button class="btn" id="bigger">+</button>
            <button class="btn" id="left">←</button>
            <button class="btn" id="right">→</button>
            <button class="btn" id="reset">R</button>
        </div>
    </div>

    <div id="status"></div>

    <a-scene 
        embedded
        arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;'
        renderer='logarithmicDepthBuffer: true; precision: medium;'
        vr-mode-ui="enabled: false">

        <a-marker preset="hiro" smooth="true">
            <a-entity 
                id="model" 
                position="0 0 0"
                rotation="0 0 0"
                scale="1 1 1">
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const status = document.getElementById('status');
        const model = document.getElementById('model');
        let scale = 1;
        let rotation = 0;

        function showStatus(message, duration = 3000) {
            status.textContent = message;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', duration);
        }

        document.getElementById('file-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                showStatus('Loading model...');
                const url = URL.createObjectURL(file);
                model.setAttribute('gltf-model', url);
                
                model.addEventListener('model-loaded', () => {
                    showStatus('Model loaded - Point camera at Hiro marker');
                }, { once: true });
                
                model.addEventListener('model-error', () => {
                    showStatus('Error loading model');
                }, { once: true });
            }
        });

        document.getElementById('smaller').onclick = () => {
            scale = Math.max(0.1, scale - 0.1);
            model.setAttribute('scale', `${scale} ${scale} ${scale}`);
        };

        document.getElementById('bigger').onclick = () => {
            scale = Math.min(3, scale + 0.1);
            model.setAttribute('scale', `${scale} ${scale} ${scale}`);
        };

        document.getElementById('left').onclick = () => {
            rotation -= 45;
            model.setAttribute('rotation', `0 ${rotation} 0`);
        };

        document.getElementById('right').onclick = () => {
            rotation += 45;
            model.setAttribute('rotation', `0 ${rotation} 0`);
        };

        document.getElementById('reset').onclick = () => {
            scale = 1;
            rotation = 0;
            model.setAttribute('scale', '1 1 1');
            model.setAttribute('rotation', '0 0 0');
            model.setAttribute('position', '0 0 0');
        };

        // Prevent AR.js from capturing UI events
        document.querySelectorAll('.btn, #file-input').forEach(el => {
            el.addEventListener('touchstart', (e) => e.stopPropagation());
            el.addEventListener('touchend', (e) => e.stopPropagation());
        });
    </script>
</body>
</html>
